# How to Prompt/Interact with M1A Backend

This guide explains how to make requests to the M1A backend API.

## Quick Start

### 1. Start the Backend Server

```bash
cd autoposter-backend
python start_backend.py
```

The backend will start on:
- **Base URL**: `http://localhost:8001`
- **API Docs**: `http://localhost:8001/docs` (Interactive Swagger UI)
- **Health Check**: `http://localhost:8001/api/health`

### 2. Backend Configuration

The backend runs on **port 8001** by default. For physical devices or network access:
- **iOS Simulator**: `http://localhost:8001`
- **Android Emulator**: `http://10.0.2.2:8001`
- **Physical Device**: Use your computer's IP address (e.g., `http://192.168.1.111:8001`)

## Making Requests

### Option 1: Using the AutoPosterService (Recommended for React Native)

The `AutoPosterService` class provides a clean interface for all backend operations:

```javascript
import AutoPosterService from '../services/AutoPosterService';

// Health check
const health = await AutoPosterService.healthCheck();

// Generate content
const content = await AutoPosterService.generateContent(
  "Create a post about our new service",
  "post",
  "instagram",
  "professional",
  "general"
);

// Schedule a post
const scheduled = await AutoPosterService.schedulePost({
  uid: "user123",
  content: "My post content",
  platforms: { instagram: true },
  scheduledTime: "2024-01-15T10:00:00Z",
  status: "scheduled",
  autoGenerated: false,
  createdAt: new Date().toISOString()
});

// Get scheduled posts
const posts = await AutoPosterService.getScheduledPosts();

// Get analytics
const analytics = await AutoPosterService.getAnalytics();
```

### Option 2: Using Fetch API (Direct HTTP Requests)

```javascript
const BASE_URL = 'http://localhost:8001';

// Health check
const healthResponse = await fetch(`${BASE_URL}/api/health`);
const health = await healthResponse.json();

// Generate content
const contentResponse = await fetch(`${BASE_URL}/api/generate-content`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    prompt: "Create engaging social media content",
    content_type: "post",
    platform: "instagram",
    brand_voice: "professional",
    target_audience: "general"
  })
});
const content = await contentResponse.json();

// Schedule a post
const scheduleResponse = await fetch(`${BASE_URL}/api/schedule-post`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    uid: "user123",
    content: "Post content here",
    imageUrl: "https://example.com/image.jpg",
    platforms: { instagram: true, facebook: false },
    scheduledTime: "2024-01-15T10:00:00Z",
    status: "scheduled",
    autoGenerated: false,
    createdAt: new Date().toISOString()
  })
});
const scheduled = await scheduleResponse.json();
```

### Option 3: Using cURL (Command Line Testing)

```bash
# Health check
curl http://localhost:8001/api/health

# Generate content
curl -X POST http://localhost:8001/api/generate-content \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "Create a post about our new service",
    "content_type": "post",
    "platform": "instagram",
    "brand_voice": "professional",
    "target_audience": "general"
  }'

# Get scheduled posts
curl http://localhost:8001/api/scheduled-posts

# Get analytics
curl http://localhost:8001/api/analytics
```

### Option 4: Using Python (Backend Testing)

```python
import requests

BASE_URL = "http://localhost:8001"

# Health check
response = requests.get(f"{BASE_URL}/api/health")
print(response.json())

# Generate content
data = {
    "prompt": "Create engaging content",
    "content_type": "post",
    "platform": "instagram",
    "brand_voice": "professional",
    "target_audience": "general"
}
response = requests.post(f"{BASE_URL}/api/generate-content", json=data)
print(response.json())

# Get scheduled posts
response = requests.get(f"{BASE_URL}/api/scheduled-posts")
print(response.json())
```

## Available API Endpoints

### Core Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/health` | GET | Check backend health status |
| `/api/generate-content` | POST | Generate AI content |
| `/api/schedule-post` | POST | Schedule a new post |
| `/api/scheduled-posts` | GET | Get all scheduled posts |
| `/api/scheduled-posts/{id}` | PUT | Update a scheduled post |
| `/api/scheduled-posts/{id}` | DELETE | Delete a scheduled post |

### Media Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/media-library` | GET | Get media library |
| `/api/upload-media` | POST | Upload media file |

### AutoPoster Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/auto-poster-status` | GET | Get auto poster status |
| `/api/toggle-auto-poster` | POST | Enable/disable auto poster |
| `/api/analytics` | GET | Get analytics data |
| `/api/platform-settings` | GET | Get platform settings |
| `/api/test-connection/{platform}` | POST | Test platform connection |

### Booking Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/event-booking` | POST | Create event booking |
| `/api/event-bookings` | GET | Get event bookings |
| `/api/service-booking` | POST | Create service booking |
| `/api/service-bookings` | GET | Get service bookings |
| `/api/bar-order` | POST | Create bar order |
| `/api/bar-orders` | GET | Get bar orders |

### Payment Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/payments/health` | GET | Check payment service status |
| `/api/payments/create-intent` | POST | Create Stripe payment intent |
| `/api/payments/confirm` | POST | Confirm payment |

## Example: Complete Content Generation Flow

```javascript
// 1. Check backend health
const health = await AutoPosterService.healthCheck();
console.log('Backend status:', health);

// 2. Generate content
const generated = await AutoPosterService.generateContent(
  "Announce our grand opening event",
  "post",
  "instagram",
  "friendly",
  "local-community"
);

if (generated.success) {
  console.log('Generated content:', generated.content);
  
  // 3. Schedule the post
  const scheduled = await AutoPosterService.schedulePost({
    uid: user.uid,
    content: generated.content,
    platforms: { instagram: true },
    scheduledTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
    status: "scheduled",
    autoGenerated: true,
    createdAt: new Date().toISOString()
  });
  
  console.log('Post scheduled:', scheduled);
}
```

## Example: Event Booking

```javascript
const booking = await fetch('http://localhost:8001/api/event-booking', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    userId: "user123",
    eventType: "birthday",
    eventDate: "2024-02-15",
    eventStartTime: "18:00",
    guestCount: 50,
    duration: 4,
    firstName: "John",
    lastName: "Doe",
    email: "john@example.com",
    phone: "555-1234",
    totalCost: 2500.00,
    isWeekday: false
  })
});

const result = await booking.json();
console.log('Booking created:', result.bookingId);
```

## Troubleshooting

### Backend Not Responding

1. **Check if backend is running:**
   ```bash
   curl http://localhost:8001/api/health
   ```

2. **Check the port:**
   - Default port is `8001`
   - Change with: `set API_PORT=8002` (Windows) or `export API_PORT=8002` (Mac/Linux)

3. **Check firewall/network:**
   - For physical devices, ensure your computer and device are on the same network
   - Use your computer's IP address instead of `localhost`

### CORS Errors

The backend is configured to allow CORS from all origins. If you see CORS errors:
- Ensure the backend is running
- Check that you're using the correct base URL
- Verify the request headers include `Content-Type: application/json`

### Connection Refused

- **iOS Simulator**: Use `http://localhost:8001`
- **Android Emulator**: Use `http://10.0.2.2:8001`
- **Physical Device**: Use your computer's IP (e.g., `http://192.168.1.111:8001`)

To find your IP address:
- **Windows**: `ipconfig` (look for IPv4 Address)
- **Mac/Linux**: `ifconfig` or `ip addr`

## Interactive API Documentation

Visit `http://localhost:8001/docs` in your browser to see:
- All available endpoints
- Request/response schemas
- Try endpoints directly from the browser
- See example requests and responses

## Next Steps

- See `autoposter-backend/docs/API_DOCUMENTATION.md` for detailed API documentation
- See `autoposter-backend/START_BACKEND.md` for backend setup instructions
- Use `autoposter-backend/test_api.py` to test the backend


